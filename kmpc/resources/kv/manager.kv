#:kivy 1.10.0
#:import ManagerLibraryTabbedPanelItem kmpc.managerlibrarypanel.ManagerLibraryTabbedPanelItem
#:import normalfont kmpc.widgets.normalfont
#:import fontawesomefont kmpc.widgets.fontawesomefont
#:import listbackdrop kmpc.widgets.listbackdrop
#:import ratingstars kmpc.widgets.ratingstars

<OLabel@Label>:
    font_name: normalfont
    font_size: '20sp'
    outline_color: [0,0,0]
    outline_width: '1sp'
    color: [1,1,1,1]

<OButton@Button+OLabel>:
    border: (4,4,4,4)
    background_normal: buttonnormal
    background_down: buttondown
    font_name: normalfont
    font_size: '20sp'

<SmallButton@OButton>:
    font_size: '16sp'
    size_hint_min_y: '48sp'
    size_hint_y: None

<StarLabel@OLabel>:
    font_name: fontawesomefont
    markup: True

<ArtistRow>:
    canvas.before:
        Color:
            rgba: (1,1,0,0.5) if self.selected else (0,0,0,0)
        Rectangle:
            size: self.size
            pos: self.pos
        Color:
            rgba: (1,1,1,0.3)
        Rectangle:
            size: (self.width,sp(1))
            pos: self.pos
        Rectangle:
            size: (self.width,sp(1))
            pos: (self.x,self.top)
    artist_id: ''
    artist_name: ''
    has_artistbackground: False
    has_logo: False
    has_badge: False
    BoxLayout:
        orientation: 'horizontal'
        UneditTextInput:
            multiline: False
            halign: 'left'
            valign: 'center'
            text_size: self.size
            text: root.artist_name
            padding_x: sp(10)
            background_color: (1,1,0,1) if root.selected else (1,1,1,1)
        UneditTextInput:
            multiline: False
            halign: 'left'
            valign: 'center'
            text_size: self.size
            text: root.artist_id
            padding_x: sp(10)
            background_color: (1,1,0,1) if root.selected else (1,1,1,1)
        OLabel:
            size_hint_x: 0.08
            halign: 'left'
            valign: 'center'
            text_size: self.size
            text: 'Y' if root.has_artistbackground else 'N'
            padding_x: sp(10)
        OLabel:
            size_hint_x: 0.08
            halign: 'left'
            valign: 'center'
            text_size: self.size
            text: 'Y' if root.has_logo else 'N'
            padding_x: sp(10)
        OLabel:
            size_hint_x: 0.08
            halign: 'left'
            valign: 'center'
            text_size: self.size
            text: 'Y' if root.has_badge else 'N'
            padding_x: sp(10)

<LibraryRow>:
    canvas.before:
        Color:
            rgba: app.get_color('listitemselected') if self.selected else app.get_color('listitem')
        Rectangle:
            source: listbackdrop
            size: self.size
            pos: self.pos
        Color:
            rgba: (1,1,1,0.3)
        Rectangle:
            size: (self.width,sp(1))
            pos: self.pos
        Rectangle:
            size: (self.width,sp(1))
            pos: (self.x,self.top)
    value: ''
    base: 'root'
    level: 'root'
    upto: None
    info: {}
    copy_flag: ''
    rating: ''
    BoxLayout:
        orientation: 'horizontal'
        OLabel:
            halign: 'left'
            valign: 'center'
            text_size: self.size
            text: root.value
            padding_x: sp(10)
        StarLabel:
            size_hint_x: 0.2
            text: '[ref=rating]'+ratingstars[int(root.rating)]+'[/ref]' if root.rating else '[ref=rating]'+ratingstars[11]+'[/ref]'
            on_ref_press: root.rating_popup(root)
        OLabel:
            size_hint_x: 0.2
            text: root.copy_flag

<ManagerLibraryTabbedPanelItem>:
    text: 'Library'
    rv: rv
    rbl: rbl
    config: app.config
    current_header: current_header
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            canvas.before:
                Color:
                    rgba: (.25,.25,.25,1)
                Rectangle:
                    size: self.size
                    pos: self.pos
            size_hint_min_y: '24sp'
            size_hint_y: None
            OLabel:
                size_hint_y: None
                halign: 'center'
                valign: 'middle'
                text_size: self.size
                id: status
                text: ''
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            size_hint_min_y: '48sp'
            SmallButton:
                text: 'Generate synclist'
                id: generate_button
                on_press: root.generate_list('synclist')
            SmallButton:
                text: 'Generate playlist'
                id: generate_playlist_button
                on_press: root.generate_list('playlist')
            OLabel:
                text: 'Minimum stars:'
            TextInput:
                id: minimum_stars
                text: '5'
                font_size: '16sp'
        BoxLayout:
            size_hint_y: None
            size_hint_min_y: '48sp'
            orientation: 'horizontal'
            ToggleButton:
                text: 'Files'
                id: files_button
                on_press: root.change_view_type(self.text)
            ToggleButton:
                text: 'Albums'
                id: albums_button
                on_press: root.change_view_type(self.text)
            ToggleButton:
                text: 'Tracks'
                id: tracks_button
                on_press: root.change_view_type(self.text)
            ToggleButton:
                text: 'Playlists'
                id: playlists_button
                on_press: root.change_view_type(self.text)
        OLabel:
            id: current_header
            size_hint_y: None
            size_hint_min_y: '24sp'
            padding_x: sp(10)
            text: ''
            text_size: self.size
            halign: 'center'
            valign: 'middle'
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.6
            RecycleView:
                id: rv
                rv_selection: {}
                scroll_type: ['bars','content']
                bar_width: sp(40)
                do_scroll_x: False
                viewclass: 'LibraryRow'
                LibraryRecycleBoxLayout:
                    id: rbl
                    default_size: None, sp(24)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: 'vertical'
                    spacing: sp(2)
                    multiselect: True
                    touch_multiselect: True
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: '0.05'
                OButton:
                    text: '+'
                    on_press: root.set_copy_flag('Y')
                OButton:
                    text: '-'
                    on_press: root.set_copy_flag('N')
                OButton:
                    text: '/'
                    on_press: root.set_copy_flag('')

<ManagerInterface>:
    do_default_tab: False
    active_tab: None
    background_color: app.get_color('backdrop')
    background_image: backdrop
    TabbedPanelItem:
        text: 'Artists'
        id: artist_tab
        rv: rv
        rbl: rbl
        BoxLayout:
            orientation: 'vertical'
            BoxLayout:
                canvas.before:
                    Color:
                        rgba: (.25,.25,.25,1)
                    Rectangle:
                        size: self.size
                        pos: self.pos
                size_hint_min_y: '24sp'
                size_hint_y: None
                OLabel:
                    halign: 'center'
                    valign: 'middle'
                    size_hint_y: None
                    id: status
                    text: ''
            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: None
                size_hint_min_y: '48sp'
                SmallButton:
                    text: 'Refresh from mpd and internet'
                    on_press: root.refresh_artists()
                SmallButton:
                    text: 'Refresh from cache'
                    on_press: root.refresh_artists_from_cache()
                SmallButton:
                    text: 'Write to cache'
                    on_press: root.write_artists_to_cache()
            BoxLayout:
                orientation: 'horizontal'
                size_hint_y: None
                size_hint_min_y: '48sp'
                SmallButton:
                    text: 'Scan row'
                    on_press: root.scan_row_for_media()
                SmallButton:
                    text: 'Scan all'
                    on_press: root.scan_all_for_media()
                SmallButton:
                    text: 'Pull art for row'
                    on_press: root.pull_art_for_row()
                SmallButton:
                    text: 'Pull art for all'
                    on_press: root.pull_art_for_all()
            RecycleView:
                id: rv
                rv_selection: {}
                do_scroll_x: False
                scroll_type: ['bars','content']
                bar_width: sp(40)
                viewclass: 'ArtistRow'
                ArtistRecycleBoxLayout:
                    id: rbl
                    default_size: None, sp(24)
                    default_size_hint: 1, None
                    size_hint_y: None
                    height: self.minimum_height
                    orientation: 'vertical'
                    spacing: sp(2)
                    multiselect: False
                    touch_multiselect: False
    ManagerLibraryTabbedPanelItem:
        id: library_tab
    TabbedPanelItem:
        text: 'System'
        BoxLayout:
            orientation: 'vertical'
            Button:
                text: 'Config'
                on_press: app.open_settings()
            Button:
                text: 'Exit'
                on_press: app.stop()

