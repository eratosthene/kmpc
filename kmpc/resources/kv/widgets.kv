#:kivy 1.10.0
#:import OutlineLabel kmpc.widgets.OutlineLabel
#:import OutlineButton kmpc.widgets.OutlineButton
#:import ClearButton kmpc.widgets.ClearButton
#:import StarBoxButton kmpc.widgets.StarBoxButton
#:import InfoLargeLabel kmpc.widgets.InfoLargeLabel
#:import RatingPopup kmpc.widgets.RatingPopup
#:import CoverPopup kmpc.widgets.CoverPopup
#:import normalfont kmpc.widgets.normalfont
#:import boldfont kmpc.widgets.boldfont
#:import fontawesomefont kmpc.widgets.fontawesomefont
#:import buttonnormal kmpc.widgets.buttonnormal
#:import buttondown kmpc.widgets.buttondown
#:import clearimage kmpc.widgets.clearimage
#:import backdrop kmpc.widgets.backdrop
#:import ratingstars kmpc.widgets.ratingstars

<OutlineLabel>:
    font_name: boldfont
    font_size: '20sp'
    outline_color: [0,0,0]
    outline_width: '1sp'
    color: [1,1,1,1]

<OutlineButton>:
    font_name: boldfont

<Button>:
    border: (4,4,4,4)
    background_color: app.get_color('button')
    background_normal: buttonnormal
    background_down: buttondown
    font_name: normalfont
    font_size: '20sp'

<ClearButton>:
    border: (1,1,1,1)
    background_normal: clearimage
    background_down: clearimage
    background_disabled_normal: clearimage

<TrackSlider@Slider>:
    OutlineLabel:
        pos: (root.value_pos[0] - sp(16), root.center_y - sp(27)) if root.orientation == 'horizontal' else (root.center_x - sp(27), root.value_pos[1] - sp(16))
        size_hint: None, None
        size: sp(32), sp(32)
        text: "%02d:%02d" % (divmod(int(root.max)-int(root.value),60))

<OutlineToggleButton@ToggleButton+OutlineLabel>:

<MediaButton@OutlineButton,MediaToggleButton@ToggleButton+OutlineLabel>:
    font_name: fontawesomefont
    font_size: '24sp'

<BrightnessButton@Button+OutlineLabel>
    font_name: fontawesomefont
    font_size: '24sp'
    border: (1,1,1,1)
    background_normal: clearimage
    background_down: clearimage
    canvas.before:
        Clear
        PushMatrix
        Rotate:
            angle: 90
            origin: self.center
    canvas.after:
        PopMatrix

<SidewaysLabel@OutlineLabel>
    valign: 'middle'
    padding_x: '5sp'
    font_size: '18sp'
    canvas.before:
        Clear
        PushMatrix
        Rotate:
            angle: 90
            origin: self.center
    canvas.after:
        PopMatrix

<SettingsButton@Button+OutlineLabel>
    font_name: fontawesomefont
    font_size: '24sp'
    border: (1,1,1,1)
    background_normal: clearimage
    background_down: clearimage

<InfoLargeLabel>:
    font_size: '40sp'
    text_size: self.width, None
    height: self.texture_size[1]
    halign: 'center'
    font_name: boldfont
    canvas.before:
        Color:
            rgba: 0, 0, 0, 0.75
        Rectangle:
            pos: int(self.center_x - self.texture_size[0] / 2.) + sp(2), int(self.center_y - self.texture_size[1] / 2.) - sp(2)
            size: root.texture_size
            texture: root.texture

<InfoSmallLabel@OutlineLabel>:
    font_size: '18sp'
    text_size: self.width, None
    height: self.texture_size[1]
    halign: 'center'

<BBLabel1@OutlineLabel>:
    halign: 'left'
    valign: 'middle'
    padding_x: '5sp'
    size_hint_x: 0.25
    text_size: self.size
    
<BBLabel2@OutlineLabel>:
    halign: 'left'
    valign: 'middle'
    padding_x: '5sp'
    text_size: self.size

<StarBoxButton>:
    orientation: 'horizontal'
    pos: self.parent.pos
    size: self.parent.size
    on_press:
        if self.popup.song: self.popup.rating_set(self.popup.song,self.rating,self.popup)
        elif self.popup.index: self.popup.rating_set(self.popup.index,self.rating,self.popup)
    BBLabel1:
        font_name: fontawesomefont
        text: ratingstars[int(root.rating)] if root.rating!=None else ''
    BBLabel2:
        text: app.config.get('songratings','star'+str(root.rating)) if root.rating!=None else ''

<RatingPopup>:
    title: 'Rating'
    size_hint: (0.8,1)
    BoxLayout:
        orientation: 'horizontal'
        OutlineButton:
            on_press:
                if root.song: root.rating_set(root.song,'',root)
                elif root.index: root.rating_set(root.index,'',root)
            size_hint_x: 0.07
            font_name: fontawesomefont
            text: ratingstars[11]
        BoxLayout:
            orientation: 'vertical'
            StarBoxButton:
                rating: '0'
                popup: root
            StarBoxButton:
                rating: '1'
                popup: root
            StarBoxButton:
                rating: '2'
                popup: root
            StarBoxButton:
                rating: '3'
                popup: root
            StarBoxButton:
                rating: '4'
                popup: root
            StarBoxButton:
                rating: '5'
                popup: root
            StarBoxButton:
                rating: '6'
                popup: root
            StarBoxButton:
                rating: '7'
                popup: root
            StarBoxButton:
                rating: '8'
                popup: root
            StarBoxButton:
                rating: '9'
                popup: root
            StarBoxButton:
                rating: '10'
                popup: root
           
<CoverPopup>:
    size_hint: (0.6,1)
    BoxLayout:
        Image:
            texture:root.image_texture
            allow_stretch: True

<PlaylistSavePopup@Popup>:
    title: 'Playlist Name'
    size_hint_y: 0.5
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: 0.1
            TextInput:
                id: playlist_name
                text: ''
        BoxLayout:
            size_hint_y: 0.1
            orientation: 'horizontal'
            Button:
                text: 'OK'
                on_press: app.root.ids.playlist_tab.save_playlist(root.ids.playlist_name.text,root)
            Button:
                text: 'Cancel'
                on_press: root.dismiss()
